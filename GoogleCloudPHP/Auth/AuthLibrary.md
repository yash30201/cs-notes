# PHP Auth Library

## Caching

Auth `access_token`s are cached by default due to the setting `enableCaching` being true in `CredentialWrapper`'s `build` method.

Due to this, the credentials are further wrapped in `FetchAuthTokenCache` ([Code pointer](https://github.com/googleapis/gax-php/blob/main/src/CredentialsWrapper.php#L166-L173))

### Self signed `access_token`

> Ref: [jwt-auth](https://developers.google.com/identity/protocols/oauth2/service-account#jwt-auth)

With some Google APIs, you can make authorized API calls using a signed JWT directly as a bearer token, rather than an OAuth 2.0 access token. When this is possible, you can avoid having to make a network request to Google's authorization server before making an API call.

Google-cloud-php's hybrid components use `GrpcTrait` defined in Core which sets the

`CredentialsWrapper` has a static `build` method which create credentials and if it's a `ServiceAccountCredential`, then self signed jwt access with scope is used. [Code Pointer](https://github.com/googleapis/gax-php/blob/532d501201556db0258359882793681938f16abe/src/CredentialsWrapper.php#L160C1-L164C10)

This `build` is fired when the library tries to create credentials. This could happen at two place:

1) **For Hybrid Library**: This happends at the GrpcTrait's `getGaxConfig` method which is invoked at the Grpc class' contructor. ([code pointer](https://github.com/googleapis/google-cloud-php/blob/main/PubSub/src/Connection/Grpc.php#L109) for pubsub)
    - This is further set inside the `credentials` key in the `$grpcConfig`. This config is used to create the V1 gapic classes.
2) **For Gapic Autogenerated clients**: Creadentials are made at `GapicClientTrait`'s `setClientOptions` method at [line 408](https://github.com/googleapis/google-cloud-php/blob/main/PubSub/vendor/google/gax/src/GapicClientTrait.php#L408) where it invokes `createCredentialsWrapper`.
    - This method check the type of `credentials` it received. If it's a path or array, it eventually creates `ServiceAccountCredentials` or if it's already the required class, then it simply returns.

